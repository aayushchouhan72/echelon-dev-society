;/*FB_PKG_DELIM*/

__d("FalcoConsentChecker",[],(function(a,b,c,d,e,f){"use strict";function g(a,b,c,d){var e;switch(typeof d){case"string":e=a[String(d)];return!e?!1:e<=b;case"number":return g(a,b,c,c[Number(d)]);default:e=!1;if(Array.isArray(d)){var f=d[0];for(var h=1;h<d.length;h++){e=g(a,b,c,d[h]);if(e){if(f==="or")return!0}else if(f==="and")return!1}}return e}}f["default"]=g}),66);
__d("OdsWebBatchFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1838142");b=d("FalcoLoggerInternal").create("ods_web_batch",a);e=b;g["default"]=e}),98);
__d("FalcoLoggerInternal",["AnalyticsCoreData","FBLogger","FalcoConsentChecker","FalcoLoggerInternalState","FalcoUtils","Promise","Random","ServerTime","WebSession","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("FalcoLoggerInternalState").getInstance(),l=d("FalcoUtils").getTaggedBitmap(0),m=d("FalcoUtils").getTaggedBitmap(37),n=500*1024*.6,o={};function p(a,b,e){var f=c("Random").coinflip(b.r);if(!f){d("FalcoUtils").bumpODSMetrics(e,"event.filters.sampling",1);return!1}f=b.c;if(f!=null&&(i||(i=c("AnalyticsCoreData"))).consents!=null){b=q(f,(i||(i=c("AnalyticsCoreData"))).consents,a);if(!b){d("FalcoUtils").bumpODSMetrics(e,"event.filters.consent",1);return!1}}return!0}function q(a,b,d){var e=o[a];e==null&&(e=o[a]=JSON.parse(a));return c("FalcoConsentChecker")(b,d,e,e[0])}function r(){return(j||(j=c("performanceAbsoluteNow")))()-d("ServerTime").getOffsetMillis()}function s(a,b,d,e,f,g){if((i||(i=c("AnalyticsCoreData"))).enable_observer){a=babelHelpers["extends"]({name:a,time:b,sampled:d,getData:f,policy:e},g&&{getPrivacyContext:g});x.emit("event",a)}}function t(a,b,e,f,g,h){g=JSON.stringify(g);if(g.length>n){d("FalcoUtils").bumpODSMetrics(a,"event.filters.exceeded_size",1);c("FBLogger")("falco","oversized_message:"+a).warn('Dropping event "%s" due to exceeding the max size %s at %s',a,n,g.length);return}var j=d("FalcoUtils").xorBitmap([0,0],l);j=d("FalcoUtils").xorBitmap(j,m);b={name:a,policy:b,time:e,extra:g,privacyContext:f,tags:j,sessionId:d("WebSession").getId(),deviceId:(i||(i=c("AnalyticsCoreData"))).device_id,appVersion:i.app_version};h.wrapAndEnqueueItem(b);d("FalcoUtils").bumpODSMetrics(a,"event.captured",1)}function u(a,b,c,e,f){try{var g=r();d("FalcoUtils").bumpODSMetrics(a,"event.logged",1);var h=p(g,b,a);if(h){var i=e(),j=c&&c();t(a,b,g,j,i,f)}s(a,g,h,b,e,c)}catch(a){w(a)}}function v(a,c,e,f,g){try{var i=r();d("FalcoUtils").bumpODSMetrics(a,"event.logged",1);var j=p(i,c,a);if(j){var k=f(),l=(h||(h=b("Promise"))).resolve(e&&e());return h.all([k,l]).then(function(b){var d=b[0],e=b[1];t(a,c,i,e,d,g);s(a,i,j,c,function(){return d},e&&function(){return e})})}else{s(a,i,j,c,f,e);return(h||(h=b("Promise"))).resolve()}}catch(a){return(h||(h=b("Promise"))).reject(a)}}function w(a){var b=c("FBLogger")("falco");a instanceof Error?b.catching(a).warn("Error while attempting to log to Falco"):b.warn("Caught non-error while attempting to log to Falco: %s",JSON.stringify(a))}var x=k.observable;function a(a,b){var c=k.logQueue,d=k.logImmediatelyQueue,e=k.logCriticalQueue;return{log:function(d,e){u(a,b,e,d,c)},logAsync:function(d,e){v(a,b,e,d,c)["catch"](w)},logImmediately:function(c,e){u(a,b,e,c,d)},logCritical:function(c,d){u(a,b,d,c,e)},logRealtimeEvent:function(c,d){u(a,b,d,c,e)}}}g.observable=x;g.create=a}),98);
__d("FalcoLoggerInternalState",["AnalyticsCoreData","BaseEventEmitter","FalcoUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(){this.queuesMap=new Map();var a=d("FalcoUtils").identityToString((h||(h=c("AnalyticsCoreData"))).identity);this.observable=new(c("BaseEventEmitter"))();this.logQueue=d("FalcoUtils").createQueue("falco_queue_log",a,this.queuesMap);this.logImmediatelyQueue=d("FalcoUtils").createQueue("falco_queue_immediately",a,this.queuesMap);this.logCriticalQueue=d("FalcoUtils").createQueue("falco_queue_critical",a,this.queuesMap)}a.getInstance=function(){a.$1||(a.$1=new a());return a.$1};return a}();a.$1=null;g["default"]=a}),98);
__d("FalcoUtils",["AnalyticsCoreData","ODS","PersistedQueue","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="ods_web_batch",k=b(33);function l(a){var b;a.tags=m((b=a.tags)!=null?b:[0,0],k);return a}function a(a){if(a){var b=a.fbIdentity,c=a.appScopedIdentity;a=a.claim;var d="";if(b){var e=b.accountId;b=b.actorId;d=e+"^#"+b+"^#"}else c!==void 0&&(d="^#^#"+c);return d+"^#"+a}return""}function b(a){return a>30?[0,1<<a-30]:[1<<a,0]}function m(a,b){return[a[0]|b[0],a[1]|b[1]]}function e(a,b,e){if(a===j)return;(i||(i=d("ODS"))).bumpEntityKey(7173,"entities.ff_js_web."+a+"."+(h||(h=c("AnalyticsCoreData"))).app_id+"."+((a=(h||(h=c("AnalyticsCoreData"))).app_version)!=null?a:"0").split(".")[0]+"."+h.push_phase,b,e)}function f(a,b,d){var e;e=(e=c("PersistedQueue").getSuffixesForKey(a))!=null?e:[];e.push(b);for(e of e){var f,g=a+"^$"+e;if(d.has(g))continue;f=((f=(h||(h=c("AnalyticsCoreData"))).use_falco_as_mutex_key)!=null?f:!1)?c("PersistedQueue").create(a,{onLoad:l,queueNameSuffix:e,application:"falco"}):c("PersistedQueue").create(a,{onLoad:l,queueNameSuffix:e});d.set(g,f)}return c("nullthrows")(d.get(a+"^$"+b))}g.identityToString=a;g.getTaggedBitmap=b;g.xorBitmap=m;g.bumpODSMetrics=e;g.createQueue=f}),98);
__d("ODS",["ExecutionEnvironment","FBLogger","OdsWebBatchFalcoEvent","Random","Run","clearTimeout","gkx","setTimeout"],(function(a,b,c,d,e,f,g){var h,i,j=(h||(h=c("ExecutionEnvironment"))).canUseDOM||(h||c("ExecutionEnvironment")).isInWorker,k={};function l(a,b,c,d,e){var f;d===void 0&&(d=1);e===void 0&&(e=1);var g=(f=k[b])!=null?f:null;if(g!=null&&g<=0)return;i=i||{};var h=i[a]||(i[a]={}),j=h[b]||(h[b]={}),l=j[c]||(j[c]={n:0,d:null}),m=Number(d),o=Number(e);g>0&&(m/=g,o/=g);if(!isFinite(m)||!isFinite(o))return;l.n+=m;if(arguments.length>=5){var p=l.d;p==null&&(p=0);l.d=p+o}n()}var m;function n(){if(m!=null)return;m=c("setTimeout")(function(){o()},c("gkx")("20935")?13e3/2:5e3)}function a(a,b){if(!j)return;k[a]=d("Random").random()<b?b:0}function b(a,b,c,d){d===void 0&&(d=1);if(!j)return;l(a,b,c,d)}function e(a,b,c,d,e){d===void 0&&(d=1);e===void 0&&(e=1);if(!j)return;l(a,b,c,d,e)}function o(a){a===void 0&&(a="normal");if(!j)return;c("clearTimeout")(m);m=null;if(i==null)return;var b=i;i=null;function d(){return{batch:b}}a==="critical"?c("OdsWebBatchFalcoEvent").logCritical(d):c("OdsWebBatchFalcoEvent").log(d)}j&&d("Run").onUnload(function(){o("critical")});g.setEntitySample=a;g.bumpEntityKey=b;g.bumpFraction=e;g.flush=o}),98);